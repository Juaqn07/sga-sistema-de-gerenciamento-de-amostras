{% extends "core/base.html" %}
{% load static %}

{% block title %}Processos do Setor{% endblock title %}

{% block page_css %}
    <link rel="stylesheet" href="{% static 'samples/css/processos-do-setor.css' %}">
{% endblock page_css %}

{% block content %}
<div class="justify-content-between align-items-center titulo-descricao">
  <h4 class="mb-0 fw-semibold">Processos do Setor</h4>
  <small class="text-muted">{{ processos.count }} de {{ total_processos }} processos</small>
</div>

<div class="container-fluid p-4">
  <div class="bg-white p-4 rounded shadow-sm">
    <div class="row g-3 align-items-center mb-4">
      <div class="col-md-6 col-lg-6">
        <input
          class="form-control"
          type="search"
          placeholder="Buscar por título, número, código de rastreio..."
          aria-label="Search"
        />
      </div>
      <div class="col-md-3 col-lg-3">
        <select class="form-select">
          <option selected>Todos os Status</option>
          <option>Não Atribuído</option>
          <option>Atribuído</option>
          <option>Em Separação</option>
          <option>Pendente</option>
          <option>Pronto para Envio</option>
          <option>Em Rota de Entrega</option>
          <option>Não Entregue</option>
          <option>Entregue</option>
        </select>
      </div>
      <div class="col-md-3 col-lg-3">
        <select class="form-select">
          <option selected>Todas as Prioridades</option>
          <option>Alta</option>
          <option>Normal</option>
          <option>Baixa</option>
        </select>
      </div>
    </div>

    <table class="table align-middle">
      <thead class="table-light">
        <tr>
          <th>Código/Rastreio</th>
          <th>Título</th>
          <th>Cliente</th>
          <th>Status</th>
          <th class="text-center">Ações</th>
        </tr>
      </thead>
      <tbody>
        
        {% for processo in processos %}
        <tr>
          <td>
            <div class="fw-semibold">
              {{ processo.codigo }}
              <span class="badge bg-danger ms-1">{{ processo.get_prioridade_display }}</span>
            </div>
            <div class="text-muted small">{{ processo.codigo_rastreio }}</div>
          </td>
          <td>
            <div class="fw-semibold">{{ processo.titulo }}</div>
            <div class="text-muted small">{{ processo.tipo_amostra }}</div>
          </td>
          <td>
            <div class="fw-semibold">{{ processo.cliente.nome }}</div>
            <div class="text-muted small">A/C: {{ processo.cliente.responsavel }}</div>
          </td>
          <td>
            <span class="badge bg-primary-subtle text-primary px-3 py-2"
              >{{ processo.get_status_display }}</span
            >
          </td>

          <td class="text-center">
            <a
              href="{% url 'samples:detalhe_processo' processo.id %}"
              class="text-secondary"
              title="Visualizar Detalhes"
            >
              <i class="bi bi-eye me-2" role="button"></i>
            </a>
            <i
              class="bi bi-pencil-square me-2 text-secondary"
              role="button"
              title="Alterar Status"
              data-bs-toggle="modal"
              data-bs-target="#modalAlterarStatus"
              data-processo-id="{{ processo.codigo }}"
              data-processo-titulo="{{ processo.titulo }}"
              data-processo-status="{{ processo.status }}"
            ></i>
            <i
              class="bi bi-box me-2 text-secondary"
              role="button"
              title="Código de Rastreio"
              data-bs-toggle="modal"
              data-bs-target="#modalCodigoRastreio"
              data-processo-id="{{ processo.codigo }}"
              data-processo-titulo="{{ processo.titulo }}"
              data-processo-rastreio="{{ processo.codigo_rastreio }}"
            ></i>
            <i
              class="bi bi-chat-square-text me-2 text-secondary"
              role="button"
              title="Adicionar Comentário"
              data-bs-toggle="modal"
              data-bs-target="#modalAddComentario"
              data-processo-id="{{ processo.codigo }}"
              data-processo-titulo="{{ processo.titulo }}"
            ></i>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center p-4">
            <span class="text-muted">Nenhum processo encontrado.</span>
          </td>
        </tr>
        {% endfor %}
        
      </tbody>
    </table>
  </div>
</div>

<div
  class="modal fade"
  id="modalAlterarStatus"
  tabindex="-1"
  aria-labelledby="modalAlterarStatusLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="modalAlterarStatusLabel">
          Alterar Status
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <p id="modalProcessoInfo" class="text-muted small"></p>
        <div class="mb-3">
          <label for="modalSelectStatus" class="form-label"
            >Novo Status</label
          >
          <select class="form-select" id="modalSelectStatus">
            <option value="nao-atribuido">Não Atribuído</option>
            <option value="atribuido">Atribuído</option>
            <option value="em-separacao">Em Separação</option>
            <option value="pendente">Pendente</option>
            <option value="pronto-envio">Pronto para Envio</option>
            <option value="em-rota">Em Rota de Entrega</option>
            <option value="nao-entregue">Não Entregue</option>
            <option value="entregue">Entregue</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-bs-dismiss="modal"
        >
          Cancelar
        </button>
        <button type="button" class="btn btn-success">
          <i class="bi bi-check-circle me-1"></i> Alterar Status
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="modalCodigoRastreio"
  tabindex="-1"
  aria-labelledby="modalCodigoRastreioLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="modalCodigoRastreioLabel">
          Código de Rastreio
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <p id="modalRastreioInfo" class="text-muted small"></p>
        <div class="mb-3">
          <label for="modalRastreioInput" class="form-label"
            >Código de Rastreio (13 dígitos)</label
          >
          <input
            type="text"
            class="form-control"
            id="modalRastreioInput"
            maxlength="13"
          />
          <small class="text-muted">13/13 caracteres</small>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-bs-dismiss="modal"
        >
          Cancelar
        </button>
        <button type="button" class="btn btn-success">
          <i class="bi bi-box-arrow-in-down me-1"></i> Salvar Código
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="modalAddComentario"
  tabindex="-1"
  aria-labelledby="modalAddComentarioLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="modalAddComentarioLabel">
          Relatar ocorrência
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <p id="modalComentarioInfo" class="text-muted small"></p>
        <div class="mb-3">
          <label for="modalComentarioTextarea" class="form-label"
            ></label
          >
          <textarea
            class="form-control"
            id="modalComentarioTextarea"
            rows="4"
            placeholder="Digite sua ocorrência ou comentário..."
          ></textarea>
        </div>
        <label class="form-check-label p-3 rounded" for="fluxoGestao">
            <strong class="d-block"
              ><i class="bi bi-exclamation-triangle"></i> Encaminhar para
              Gestão</strong
            >
            <small class="text-muted"
              >Este processo Será enviado para análise de ocorrências pela
              gestão.</small
            >
        </label>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-bs-dismiss="modal"
        >
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-success"
          style="background-color: #5cb85c; border-color: #4cae4c"
        >
          <i class="bi bi-chat-square-text me-1"></i> Enviar ocorrência
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block page_js %}
    <script src="{% static 'samples/js/processos-do-setor.js' %}" defer></script>
{% endblock page_js %}